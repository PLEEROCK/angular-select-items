!function(){"use strict";angular.module("selectItems",["selectOptions","disableAll","ngSanitize"])}(),angular.module("selectItems").run(["$templateCache",function(e){e.put("select-items.html",'<div class="select-items"\n     ng-show="search\n            || (loadingInProgress && loadingLabel)\n            || (multiselect && selectAll && getDisplayedItems().length > 0)\n            || (!multiselect && !autoSelect && !hideNoSelection && noSelectionLabel)\n            || getDisplayedItems().length > 0"\n        disable-all="disabled"> <!-- todo: try to cache displayed items length -->\n    <ul>\n        <li ng-show="loadingInProgress" class="select-list-item">{{ loadingLabel }}</li>\n        <li ng-show="search && !loadingInProgress" class="select-items-search select-list-item">\n            <input ng-model="searchKeyword" ng-attr-placeholder="{{ searchPlaceholder }}">\n        </li>\n        <li class="select-all select-list-item"\n            ng-class="{ \'can-be-active\' : activeItem === null }"\n            ng-show="multiselect && selectAll && getDisplayedItems().length > 0"\n            ng-mouseover="setActiveItem(null)"\n            ng-click="toggleAllItemsSelection()">\n            <input ng-show="!hideControls" type="checkbox" ng-checked="areAllItemsSelected()">\n            <span class="select-all">{{ areAllItemsSelected() ? deselectAllLabel : selectAllLabel }}</span>\n        </li>\n        <li ng-show="!multiselect && !autoSelect && !hideNoSelection && noSelectionLabel && getDisplayedItems().length > 0"\n            ng-click="selectItem()"\n            ng-mouseover="setActiveItem(null)"\n            ng-class="{ \'active\' : !activeItem }"\n            class="no-selection select-list-item">\n            <input ng-show="!hideControls" type="radio" ng-checked="!isAnyItemSelected()"> {{ noSelectionLabel }}\n        </li>\n        <li ng-repeat="item in getDisplayedItems()"\n            class="select-item">\n            <div class="select-item-container">\n                <div class="select-list-item select-items-group"\n                     ng-class="{ \'all-selected\': areAllGroupItemsSelected(item), \'select-all-enabled\': groupSelectAll }"\n                     ng-mouseover="setActiveItem(null)"\n                     ng-show="($index === 0 || getItemGroup(item) !== getItemGroupOfItemsAt($index - 1)) && getItemGroup(item)"\n                     ng-click="toggleGroupItemsSelection(item)">\n                    <input class="item-control"\n                           ng-show="groupSelectAll"\n                           type="checkbox"\n                           ng-checked="areAllGroupItemsSelected(item)">\n                    <span class="select-item-group-template" ng-bind-html="getItemGroup(item)"></span>\n                </div>\n                <div class="select-list-item"\n                     ng-mouseover="setActiveItem(item)"\n                     ng-click="selectItem(item)"\n                     ng-class="{ \'active\' : activeItem === item, \'selected\': isItemSelected(item) }">\n                    <input class="item-control"\n                           ng-show="!hideControls"\n                           ng-attr-type="{{ multiselect ? \'checkbox\' : \'radio\' }}"\n                           ng-disabled="selectionLimit > 0 && ngModel.length >= selectionLimit && !isItemSelected(item)"\n                           ng-checked="isItemSelected(item)">\n                    <span class="select-item-template" ng-bind-html="getItemName(item)"></span>\n                </div>\n            </div>\n        </li>\n    </ul>\n</div>')}]),function(){"use strict";function e(){return function(e,l){return l?e.replace(new RegExp("("+t(l)+")","ig"),'<span class="highlighted">$1</span>'):e}}function t(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}angular.module("selectItems").filter("selectItemsHighlightWord",e)}(),function(){"use strict";angular.module("selectItems").constant("selectItemsConfiguration",{searchPlaceholder:"Type to search",selectAllLabel:"Select all",deselectAllLabel:"Deselect all",noSelectionLabel:"Nothing is selected",loadingLabel:"",loadMinQueryLength:3,loadDelay:300,showLimit:null})}(),function(){"use strict";function e(e){return{scope:{ngModel:"=",disabled:"=?",multiselect:"=?",showLimit:"=?",selectionLimit:"=?",search:"=?",searchFilter:"=?",searchKeyword:"=?",autoSelect:"=?",selectAll:"=?",groupSelectAll:"=?",hideControls:"=?",hideNoSelection:"=?",searchPlaceholder:"@",selectAllLabel:"@",deselectAllLabel:"@",noSelectionLabel:"@",loadingLabel:"@",loadPromise:"=?",loadByKeywordPromise:"=?",loadByKeywordDelay:"=?",loadByKeywordMinQueryLength:"@",filters:"=?",decorator:"=?",groupDecorator:"=?",activeItem:"=?",modelInsertPosition:"=?"},replace:!0,restrict:"E",require:["ngModel","selectOptions"],controller:"SelectItemsCtrl",template:function(t){var l=t.html().trim();return l?'<div class="select-items">'+l+"</div>":e.get("select-items.html")}}}function t(e,t,l,n,s,i,c,o,a){e.showLimit=e.showLimit?parseInt(e.showLimit):c.showLimit,e.searchPlaceholder=e.searchPlaceholder||c.searchPlaceholder,e.selectAllLabel=e.selectAllLabel||c.selectAllLabel,e.deselectAllLabel=e.deselectAllLabel||c.deselectAllLabel,e.noSelectionLabel=e.noSelectionLabel||c.noSelectionLabel,e.loadingLabel=e.loadingLabel||c.loadingLabel,e.loadByKeywordMinQueryLength=l.loadByKeywordMinQueryLength?parseInt(l.loadByKeywordMinQueryLength):c.loadMinQueryLength,e.loadByKeywordDelay=e.loadByKeywordDelay?parseInt(l.loadByKeywordDelay):c.loadByKeywordDelay;var r=t.controller("ngModel"),m=t.controller("selectOptions"),u=null,d=[],g=function(t,l){e.loadingInProgress=!0,d=[],t(l).then(function(t){t.data&&angular.isArray(t.data)&&(d=t.data),e.loadingInProgress=!1},function(t){throw e.loadingInProgress=!1,t})};e.getItemGroup=function(t){var l=m.parseItemGroup(t);return l&&(l=String(l).replace(/<[^>]+>/gm,"")),e.groupDecorator?e.groupDecorator(t):l},e.getItemGroupOfItemsAt=function(t){return e.getItemGroup(e.getDisplayedItems()[t])},e.getItemName=function(t){var l=m.parseItemName(t);return l=String(l).replace(/<[^>]+>/gm,""),e.decorator?e.decorator(t):a(l,e.searchKeyword)},e.getItems=function(){var t=m.parseItems()||[];return d.length>0&&(t=t.concat(d)),e.filters&&angular.forEach(e.filters,function(e){t=e(t)}),e.showLimit&&t.length>e.showLimit&&(t=t.slice(0,e.showLimit)),t},e.getDisplayedItems=function(){var t=e.getItems();return e.searchKeyword&&(t=i(t,e.searchKeyword,e.searchFilter)),m.getOrderBy()&&(t=s(t,m.getOrderBy())),m.getGroupBy()&&(t=s(t,m.getGroupByWithoutPrefixes())),t},e.isItemSelected=function(t){var l=r.$modelValue,n=m.parseItemValue(t),s=m.getTrackBy(),i=m.parseTrackBy(t);if(!s||!i)return e.multiselect?l&&-1!==l.indexOf(n):l===n;if(e.multiselect){var c=!1;return angular.forEach(l,function(e){e[s]===i&&(c=!0)}),c}return l[s]===i},e.areAllGroupItemsSelected=function(t){if(e.multiselect){var l=e.getDisplayedItems(),n=e.getItemGroup(t),s=!1;return angular.forEach(l,function(t){n===e.getItemGroup(t)&&(s=s||!e.isItemSelected(t))}),s===!1}},e.isAnyItemSelected=function(){return e.multiselect?r.$modelValue&&r.$modelValue.length>0:r.$modelValue?!0:!1},e.areAllItemsSelected=function(){var t=e.getDisplayedItems(),l=!1;return angular.forEach(t,function(t){l=l||!e.isItemSelected(t)}),l===!1},e.selectItem=function(s){var i=m.parseItemValue(s),c=!1,o=null,a=i;if(e.multiselect)if(a=r.$modelValue||[],e.isItemSelected(s)||null===i){var u=m.findItemInModel(s,a);a.splice(a.indexOf(u),1)}else{if(a.length>=e.selectionLimit)return;angular.isDefined(e.modelInsertPosition)?a.splice(e.modelInsertPosition,0,i):a.push(i),o=e.modelInsertPosition,c=!0}r.$setViewValue(a),l.onChange&&(console.log(l.onChange),n(function(){m.applyOnScope(l.onChange)}));var d={item:s,isMultiselect:e.multiselect,isNewSelection:c,index:o,element:t[0]};e.$emit("select-items.item_selected",d)},e.selectAllItems=function(){if(e.multiselect){var t=e.getDisplayedItems();angular.forEach(t,function(t){e.isItemSelected(t)||e.selectItem(t)})}},e.deselectAllItems=function(){if(e.multiselect){var t=e.getDisplayedItems();angular.forEach(t,function(t){e.isItemSelected(t)&&e.selectItem(t)})}},e.toggleAllItemsSelection=function(){e.areAllItemsSelected()?e.deselectAllItems():e.selectAllItems()},e.selectGroupItems=function(t){if(e.multiselect&&e.groupSelectAll){var l=e.getItemGroup(t),n=e.getDisplayedItems();angular.forEach(n,function(t){l!==e.getItemGroup(t)||e.isItemSelected(t)||e.selectItem(t)})}},e.deselectGroupItems=function(t){if(e.multiselect&&e.groupSelectAll){var l=e.getItemGroup(t),n=e.getDisplayedItems();angular.forEach(n,function(t){l===e.getItemGroup(t)&&e.isItemSelected(t)&&e.selectItem(t)})}},e.toggleGroupItemsSelection=function(t){e.multiselect&&e.groupSelectAll&&(e.areAllGroupItemsSelected(t)?e.deselectGroupItems(t):e.selectGroupItems(t))},e.setActiveItem=function(t){e.activeItem=t},e.loadByKeywordPromise&&e.$watch("searchKeyword",function(t){e.loadByKeywordPromise&&t&&t.length>=e.loadByKeywordMinQueryLength&&(null!==u&&n.cancel(u),u=n(function(){g(e.loadByKeywordPromise,t)},e.loadByKeywordDelay))}),e.$on("select-items.active_next",function(){var t=o.previous(e.getDisplayedItems(),e.activeItem);(t||!e.multiselect)&&(e.activeItem=t)}),e.$on("select-items.active_previous",function(){e.activeItem=o.next(e.getDisplayedItems(),e.activeItem)});var I=this;if(e.$on("select-items.select_active",function(e){e.isItemSelected=I.selectActive()}),e.$on("$destroy",function(){u&&n.cancel(u)}),this.selectActive=function(){var t=e.getDisplayedItems();return t.length>0&&-1!==t.indexOf(e.activeItem)?(e.selectItem(e.activeItem),!0):!1},e.autoSelect){var h=e.getDisplayedItems();h.length>0&&e.selectItem(h[0])}e.$watch("loadPromise",function(e){e&&g(e)})}angular.module("selectItems").directive("selectItems",e),angular.module("selectItems").controller("SelectItemsCtrl",t),e.$inject=["$templateCache"],t.$inject=["$scope","$element","$attrs","$timeout","orderByFilter","filterFilter","selectItemsConfiguration","SelectItemsActiveItemNavigator","selectItemsHighlightWordFilter"]}(),function(){"use strict";function e(){return{previous:function(e,t){if(!e||0===e.length)return null;var l=e.indexOf(t);return l>0&&e[l-1]?e[l-1]:e[0]},next:function(e,t){if(!e||0===e.length)return null;if(!t)return e[0];var l=e.indexOf(t);return t&&l>-1&&e[l+1]?e[l+1]:-1===l?e[0]:t}}}angular.module("selectItems").factory("SelectItemsActiveItemNavigator",e)}();