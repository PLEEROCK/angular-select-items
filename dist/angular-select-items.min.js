"use strict";angular.module("selectItems",["selectOptions","disableAll","ngSanitize"]),angular.module("selectItems").run(["$templateCache",function(e){e.put("select-items.html",'<div class="select-items"\n     ng-show="search\n            || (loadingInProgress && loadingLabel)\n            || (multiselect && selectAll && getDisplayedItems().length > 0)\n            || (!multiselect && !autoSelect && !hideNoSelection && noSelectionLabel)\n            || getDisplayedItems().length > 0"\n        disable-all="disabled">\n    <ul>\n        <li ng-show="loadingInProgress">{{ loadingLabel }}</li>\n        <li ng-show="search && !loadingInProgress" class="select-items-search">\n            <input ng-model="searchKeyword" ng-attr-placeholder="{{ searchPlaceholder }}">\n        </li>\n        <li class="select-all"\n            ng-class="{ \'can-be-active\' : activeItem === null }"\n            ng-show="multiselect && selectAll && getDisplayedItems().length > 0"\n            ng-mouseover="setActiveItem(null)"\n            ng-click="toggleAllItemsSelection()">\n            <input ng-show="!hideControls" type="checkbox" ng-checked="areAllItemsSelected()">\n            <span class="select-all">{{ areAllItemsSelected() ? deselectAllLabel : selectAllLabel }}</span>\n        </li>\n        <li ng-show="!multiselect && !autoSelect && !hideNoSelection && noSelectionLabel"\n            ng-click="selectItem()"\n            ng-mouseover="setActiveItem(null)"\n            ng-class="{ \'active\' : !activeItem }"\n            class="no-selection">\n            <input ng-show="!hideControls" type="radio" ng-checked="!isAnyItemSelected()"> {{ noSelectionLabel }}\n        </li>\n        <li ng-repeat="item in getDisplayedItems()"\n            class="select-item">\n            <div class="select-item-container">\n                <div class="select-items-group"\n                     ng-show="($index === 0 || getItemGroup(item) !== getItemGroupOfItemsAt($index - 1)) && getItemGroup(item)"\n                     ng-click="toggleGroupItemsSelection(item)">\n                    <input class="item-control"\n                           ng-show="groupSelectAll"\n                           type="checkbox"\n                           ng-checked="areAllGroupItemsSelected(item)">\n                    <span class="select-item-group-template" ng-bind-html="getItemGroup(item)"></span>\n                </div>\n                <div ng-mouseover="setActiveItem(item)"\n                     ng-click="selectItem(item)"\n                     ng-class="{ \'active\' : activeItem === item, \'selected\': isItemSelected(item) }">\n                    <input class="item-control"\n                           ng-show="!hideControls"\n                           ng-attr-type="{{ multiselect ? \'checkbox\' : \'radio\' }}"\n                           ng-checked="isItemSelected(item)">\n                    <span class="select-item-template" ng-bind-html="getItemName(item)"></span>\n                </div>\n            </div>\n        </li>\n    </ul>\n</div>')}]),angular.module("selectItems").constant("selectItemsConfiguration",{searchPlaceholder:"Type to search",selectAllLabel:"Select all",deselectAllLabel:"Deselect all",noSelectionLabel:"Nothing is selected",loadingLabel:"",loadMinQueryLength:1,loadDelay:300,showLimit:null}),function(){function e(e,t,l,n,i,s,o){return{scope:{disabled:"=?",multiselect:"=?",showLimit:"=?",search:"=?",searchFilter:"=?",searchKeyword:"=?",autoSelect:"=?",selectAll:"=?",groupSelectAll:"=?",hideControls:"=?",hideNoSelection:"=?",searchPlaceholder:"@",selectAllLabel:"@",deselectAllLabel:"@",noSelectionLabel:"@",loadingLabel:"@",loadPromise:"=?",loadByKeywordPromise:"=?",loadByKeywordDelay:"=?",loadByKeywordMinQueryLength:"@",filters:"=?",decorator:"=?",groupDecorator:"=?",activeItem:"=?",modelInsertPosition:"=?"},replace:!0,restrict:"E",require:["ngModel","selectOptions"],template:function(e){var l=e.html().trim();return l?"<div>"+l+"</div>":t.get("select-items.html")},link:function(t,c,a,r){t.showLimit=t.showLimit?parseInt(t.showLimit):l.showLimit,t.searchPlaceholder=t.searchPlaceholder||l.searchPlaceholder,t.selectAllLabel=t.selectAllLabel||l.selectAllLabel,t.deselectAllLabel=t.deselectAllLabel||l.deselectAllLabel,t.noSelectionLabel=t.noSelectionLabel||l.noSelectionLabel,t.loadingLabel=t.loadingLabel||l.loadingLabel,t.loadByKeywordMinQueryLength=t.loadByKeywordMinQueryLength?parseInt(a.loadByKeywordMinQueryLength):l.loadByKeywordMinQueryLength,t.loadByKeywordDelay=t.loadByKeywordDelay?parseInt(a.loadByKeywordDelay):l.loadByKeywordDelay;var m=r[0],u=r[1],d=null,g=[],I=function(e,l){t.loadingInProgress=!0,g=[],e(l).then(function(e){e.data&&angular.isArray(e.data)&&(g=e.data),t.loadingInProgress=!1},function(e){throw t.loadingInProgress=!1,e})};if(t.getItemGroup=function(e){var l=u.parseItemGroup(e);return l=String(l).replace(/<[^>]+>/gm,""),t.groupDecorator?t.groupDecorator(e):l},t.getItemGroupOfItemsAt=function(e){return t.getItemGroup(t.getDisplayedItems()[e])},t.getItemName=function(e){var l=u.parseItemName(e);return l=String(l).replace(/<[^>]+>/gm,""),t.decorator?t.decorator(e):o(l,t.searchKeyword)},t.getItems=function(){var e=u.parseItems()||[];return g.length>0&&(e=e.concat(g)),t.filters&&angular.forEach(t.filters,function(t){e=t(e)}),t.showLimit&&e.length>t.showLimit&&(e=e.slice(0,t.showLimit)),e},t.getDisplayedItems=function(){var e=t.getItems();return t.searchKeyword&&(e=s(e,t.searchKeyword,t.searchFilter)),u.getOrderBy()&&(e=i(e,u.getOrderBy())),u.getGroupBy()&&(e=i(e,u.getGroupByWithoutPrefixes())),e},t.isItemSelected=function(e){var l=m.$modelValue,n=u.parseItemValue(e),i=u.getTrackBy(),s=u.parseTrackBy(e);if(!i||!s)return t.multiselect?l&&-1!==l.indexOf(n):l===n;if(t.multiselect){var o=!1;return angular.forEach(l,function(e){e[i]===s&&(o=!0)}),o}return l[i]===s},t.areAllGroupItemsSelected=function(e){if(t.multiselect){var l=t.getDisplayedItems(),n=t.getItemGroup(e),i=!1;return angular.forEach(l,function(e){n===t.getItemGroup(e)&&(i=i||!t.isItemSelected(e))}),i===!1}},t.isAnyItemSelected=function(){return t.multiselect?m.$modelValue&&m.$modelValue.length>0:m.$modelValue?!0:!1},t.areAllItemsSelected=function(){var e=t.getDisplayedItems(),l=!1;return angular.forEach(e,function(e){l=l||!t.isItemSelected(e)}),l===!1},t.selectItem=function(e){var l=u.parseItemValue(e),n=!1,i=null,s=l;if(t.multiselect)if(s=m.$modelValue||[],t.isItemSelected(e)||null===l){var o=u.findItemInModel(e,s);s.splice(s.indexOf(o),1)}else angular.isDefined(t.modelInsertPosition)?s.splice(t.modelInsertPosition,0,e):s.push(l),i=t.modelInsertPosition,n=!0;m.$setViewValue(s);var c={item:e,isMultiselect:t.multiselect,isNewSelection:n,index:i};t.$emit("select-items.item_selected",c)},t.selectAllItems=function(){if(t.multiselect){var e=t.getDisplayedItems();angular.forEach(e,function(e){t.isItemSelected(e)||t.selectItem(e)})}},t.deselectAllItems=function(){if(t.multiselect){var e=t.getDisplayedItems();angular.forEach(e,function(e){t.isItemSelected(e)&&t.selectItem(e)})}},t.toggleAllItemsSelection=function(){t.areAllItemsSelected()?t.deselectAllItems():t.selectAllItems()},t.selectGroupItems=function(e){if(t.multiselect&&t.groupSelectAll){var l=t.getItemGroup(e),n=t.getDisplayedItems();angular.forEach(n,function(e){l!==t.getItemGroup(e)||t.isItemSelected(e)||t.selectItem(e)})}},t.deselectGroupItems=function(e){if(t.multiselect&&t.groupSelectAll){var l=t.getItemGroup(e),n=t.getDisplayedItems();angular.forEach(n,function(e){l===t.getItemGroup(e)&&t.isItemSelected(e)&&t.selectItem(e)})}},t.toggleGroupItemsSelection=function(e){t.multiselect&&t.groupSelectAll&&(t.areAllGroupItemsSelected(e)?t.deselectGroupItems(e):t.selectGroupItems(e))},t.setActiveItem=function(e){t.activeItem=e},t.loadByKeywordPromise&&t.$watch("searchKeyword",function(l){t.loadByKeywordPromise&&l&&l.length>=t.loadByKeywordMinQueryLength&&(null!==d&&e.cancel(d),d=e(function(){I(t.loadByKeywordPromise,l)},t.loadByKeywordDelay))}),t.$on("select-items.active_next",function(){var e=n.previous(t.getDisplayedItems(),t.activeItem);(e||!t.multiselect)&&(t.activeItem=e)}),t.$on("select-items.active_previous",function(){t.activeItem=n.next(t.getDisplayedItems(),t.activeItem)}),t.$on("select-items.select_active",function(e){var l=t.getDisplayedItems();l.length>0&&-1!==l.indexOf(t.activeItem)?(t.selectItem(t.activeItem),e.isItemSelected=!0):e.isItemSelected=!1}),t.$on("$destroy",function(){d&&e.cancel(d)}),t.autoSelect){var h=t.getDisplayedItems();h.length>0&&t.selectItem(h[0])}t.loadPromise&&I(t.loadPromise)}}}angular.module("selectItems").directive("selectItems",e),e.$inject=["$timeout","$templateCache","selectItemsConfiguration","SelectItemsActiveItemNavigator","orderByFilter","filterFilter","highlightWordFilter"]}(),angular.module("selectItems").filter("highlightWord",function(){function e(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}return function(t,l){return l?t.replace(new RegExp("("+e(l)+")","ig"),'<span class="highlighted">$1</span>'):t}}),angular.module("selectItems").factory("SelectItemsActiveItemNavigator",function(){return{previous:function(e,t){if(!e||0===e.length)return null;var l=e.indexOf(t);return l>0&&e[l-1]?e[l-1]:e[0]},next:function(e,t){if(!e||0===e.length)return null;if(!t)return e[0];var l=e.indexOf(t);return t&&l>-1&&e[l+1]?e[l+1]:-1===l?e[0]:t}}});